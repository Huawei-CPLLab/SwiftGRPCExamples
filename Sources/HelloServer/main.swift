// Copyright (C) 2016. Huawei Technologies Co., Ltd. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

import SwiftGRPC

// The main program is wrapped in a function so that ARC can have a chance to
// deinitialize class instances and free their underlying C resources.
func main() { 
    let cq = GRPCCompletionQueue()
    let server = grpc_server_create(nil, nil)

    fatalError("unimplemented")
}

main()

// The following is an excerpt from the gRPC API trace generated by the gRPC example C++ server.
// We are using this as a reference for prototyping the server.
/**
 15576 ev_epoll_linux.c:84]        epoll engine will be using signal: 36
 15576 ev_posix.c:106]             Using polling engine: epoll
 15576 init.c:193]                 grpc_init(void)
 15576 init.c:193]                 grpc_init(void)
 15576 completion_queue.c:139]     grpc_completion_queue_create(reserved=(nil))
 15576 server.c:984]               grpc_server_create(0x7fff52b954c0, (nil))
 15576 server.c:968]               grpc_server_register_completion_queue(server=0x15270c0, cq=0x1526f30, reserved=(nil))
 15576 server.c:1030]              grpc_server_register_method(server=0x15270c0, method=/helloworld.Greeter/SayHello, host=(null), flags=0x00000000)
 15576 metadata_array.c:42]        grpc_metadata_array_init(array=0x1527460)
 15576 server_chttp2.c:92]         grpc_server_add_insecure_http2_port(server=0x15270c0, addr=0.0.0.0:50051)
 15576 server.c:1064]              grpc_server_start(server=0x15270c0)


 15576 metadata_array.c:42]        grpc_metadata_array_init(array=0x7fff52b954b0)
 15576 metadata_array.c:47]        grpc_metadata_array_destroy(array=0x7fff52b954b0)
 15576 completion_queue.c:139]     grpc_completion_queue_create(reserved=(nil))
 15576 server.c:1413]              grpc_server_request_registered_call(server=0x15270c0, rmp=0x1527490, call=0x1527440, deadline=0x1527450, initial_metadata=0x1527460, optional_payload=0x1527478, cq_bound_to_call=0x152c8b0, cq_for_notification=0x1526f30, tag=0x1527420)
 15576 completion_queue.c:139]     grpc_completion_queue_create(reserved=(nil))
 15576 call_details.c:42]          grpc_call_details_init(cd=0x152abf0)
 15576 server.c:1371]              grpc_server_request_call(server=0x15270c0, call=0x152ab30, details=0x152abf0, initial_metadata=0x152ab50, cq_bound_to_call=0x152cbb0, cq_for_notification=0x1526f30, tag=0x152ab10)
0:50051

 15584 completion_queue.c:333]     grpc_completion_queue_next(cc=0x1526f30, deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil))
 15584 call.c:1365]                ops[0]: RECV_INITIAL_METADATA ptr=0x7f89e4006240
 15584 server.c:780]               OP[server:0x7f89e4006170]: RECV_INITIAL_METADATA
 15584 http_server_filter.c:219]   OP[http-server:0x7f89e4006188]: RECV_INITIAL_METADATA
 15584 connected_channel.c:70]     OP[connected:0x7f89e40061b8]: RECV_INITIAL_METADATA
 15584 call.c:1365]                ops[0]: RECV_MESSAGE ptr=0x7f89e4006260
 15584 server.c:780]               OP[server:0x7f89e4006170]: RECV_MESSAGE
 15584 http_server_filter.c:219]   OP[http-server:0x7f89e4006188]: RECV_MESSAGE
 15584 connected_channel.c:70]     OP[connected:0x7f89e40061b8]: RECV_MESSAGE
 15584 completion_queue.c:252]     grpc_cq_end_op(exec_ctx=0x7f89e95649f0, cc=0x1526f30, tag=0x1527420, error=null, done=0x7f89ed88c6d0, done_arg=0x7f89e8d63fa8, storage=0x7f89e8d63fd0)
 15584 completion_queue.c:394]     RETURN_EVENT[0x1526f30]: OP_COMPLETE: tag:0x1527420 OK
 15584 init.c:193]                 grpc_init(void)
 15584 completion_queue.c:139]     grpc_completion_queue_create(reserved=(nil))
 15584 server.c:1413]              grpc_server_request_registered_call(server=0x15270c0, rmp=0x1527490, call=0x1527440, deadline=0x1527450, initial_metadata=0x1527460, optional_payload=0x1527478, cq_bound_to_call=0x7f89e4007330, cq_for_notification=0x1526f30, tag=0x1527420)
 15584 call.c:1689]                grpc_call_start_batch(call=0x7f89e4005b80, ops=0x7f89e95647e0, nops=1, tag=0x7f89e4006ee0, reserved=(nil))

 15581 completion_queue.c:333]     grpc_completion_queue_next(cc=0x1526f30, deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil))

 15584 call.c:1365]                ops[0]: RECV_CLOSE_ON_SERVER cancelled=0x7f89e4006f40
 15584 server.c:780]               OP[server:0x7f89e4006170]: RECV_TRAILING_METADATA
 15584 http_server_filter.c:219]   OP[http-server:0x7f89e4006188]: RECV_TRAILING_METADATA
 15584 connected_channel.c:70]     OP[connected:0x7f89e40061b8]: RECV_TRAILING_METADATA
 15584 call.c:1689]                grpc_call_start_batch(call=0x7f89e4005b80, ops=0x7f89e9564600, nops=3, tag=0x7f89e95649d0, reserved=(nil))
 15584 call.c:1365]                ops[0]: SEND_INITIAL_METADATA
 15584 call.c:1365]                ops[1]: SEND_MESSAGE ptr=0x7f89e4007230
 15584 call.c:1365]                ops[2]: SEND_STATUS_FROM_SERVER status=0 details=(null)
 15584 server.c:780]               OP[server:0x7f89e4006170]: SEND_INITIAL_METADATA{} SEND_MESSAGE:flags=0x00000000:len=13 SEND_TRAILING_METADATA{key=67 72 70 63 2d 73 74 61 74 75 73 'grpc-status' value=30 '0'}
 15584 http_server_filter.c:219]   OP[http-server:0x7f89e4006188]: SEND_INITIAL_METADATA{} SEND_MESSAGE:flags=0x00000000:len=13 SEND_TRAILING_METADATA{key=67 72 70 63 2d 73 74 61 74 75 73 'grpc-status' value=30 '0'}
 15584 connected_channel.c:70]     OP[connected:0x7f89e40061b8]: SEND_INITIAL_METADATA{key=3a 73 74 61 74 75 73 ':status' value=32 30 30 '200', key=63 6f 6e 74 65 6e 74 2d 74 79 70 65 'content-type' value=61 70 70 6c 69 63 61 74 69 6f 6e 2f 67 72 70 63 'application/grpc', key=67 72 70 63 2d 65 6e 63 6f 64 69 6e 67 'grpc-encoding' value=69 64 65 6e 74 69 74 79 'identity', key=67 72 70 63 2d 61 63 63 65 70 74 2d 65 6e 63 6f 64 69 6e 67 'grpc-accept-encoding' value=69 64 65 6e 74 69 74 79 2c 64 65 66 6c 61 74 65 2c 67 7a 69 70 'identity,deflate,gzip'} SEND_MESSAGE:flags=0x00000000:len=13 SEND_TRAILING_METADATA{key=67 72 70 63 2d 73 74 61 74 75 73 'grpc-status' value=30 '0'}
 15584 completion_queue.c:252]     grpc_cq_end_op(exec_ctx=0x7f89e9564580, cc=0x152c8b0, tag=0x7f89e95649d0, error=null, done=0x7f89ed887db0, done_arg=0x7f89e4005c50, storage=0x7f89e4005c58)
 15584 completion_queue.c:252]     grpc_cq_end_op(exec_ctx=0x7f89e9564580, cc=0x152c8b0, tag=0x7f89e4006ee0, error=null, done=0x7f89ed887db0, done_arg=0x7f89e4005be8, storage=0x7f89e4005bf0)
 15584 completion_queue.c:447]     grpc_completion_queue_pluck(cc=0x152c8b0, tag=0x7f89e95649d0, deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil))
 15584 completion_queue.c:527]     RETURN_EVENT[0x152c8b0]: OP_COMPLETE: tag:0x7f89e95649d0 OK
 15584 completion_queue.c:541]     grpc_completion_queue_shutdown(cc=0x152c8b0)
 15584 completion_queue.c:333]     grpc_completion_queue_next(cc=0x152c8b0, deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil))
 15584 completion_queue.c:394]     RETURN_EVENT[0x152c8b0]: OP_COMPLETE: tag:0x7f89e4006ee0 OK
 15584 completion_queue.c:333]     grpc_completion_queue_next(cc=0x152c8b0, deadline=gpr_timespec { tv_sec: 9223372036854775807, tv_nsec: 0, clock_type: 1 }, reserved=(nil))
 15584 completion_queue.c:394]     RETURN_EVENT[0x152c8b0]: QUEUE_SHUTDOWN
 15584 call.c:703]                 grpc_call_destroy(c=0x7f89e4005b80)
 15584 metadata_array.c:47]        grpc_metadata_array_destroy(array=0x7f89e4006240)
 15584 completion_queue.c:561]     grpc_completion_queue_destroy(cc=0x152c8b0)
 15584 completion_queue.c:541]     grpc_completion_queue_shutdown(cc=0x152c8b0)
 15584 init.c:198]                 grpc_shutdown(void)

**/
